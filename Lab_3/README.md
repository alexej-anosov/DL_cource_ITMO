# Лабораторная работа №3

## Цель работы
Познакомиться с задачей генерации текста на примере дообучения большой языковой модели с помощью prefix tuning.

## Данные

Был взят [датесет русскоязычныx стихов](https://huggingface.co/datasets/IlyaGusev/stihi_ru). В качестве датасета были взяты первые 100тыс стихов корпуса, которые затем были разделены на обучающую и тестовую выборку 9:1. Фильтрация по авторам не использовалась, так как ни у одного автора не было достаточного количества стихотворений для обучения модели.

## Модель

В качестве pretrained llm была взята модель [ruGPT3-Medium](https://huggingface.co/ai-forever/rugpt3medium_based_on_gpt2). Она была дообучена с помощью реализации prefix-tuning в библиотеке peft.

num_virtual_tokens=15  
trainable params: 737,280 || all params: 356,609,024 || trainable%: 0.20674743216817756


## Результаты

По сравнению с состоянием, после добавления префикосов, модель хорошо дообучилась. Формат вывода стал похож по структуре на домен, стал стабильно стихотворным, однако рифмы не появилось. 

По charF метрике, дообученная модель немного уступает исходной. Вероятно, при увеличении количества данных и тренировочных эпох можно было бы добиться более хороших результатов. В настоящий момент модель обучалась 12 часов на видеокарте P100 16GB. 

| Модель                 | charF                    |
|:----------------------:|:------------------------:| 
| Pretrained             | 0.282                    |
| Finetuned              | 0.243                    | 

UPD: после еще 8 часов обучения:
| Модель                 | charF                    |
|:----------------------:|:------------------------:| 
| Pretrained             | 0.289                    |
| Finetuned              | 0.268                    | 
* тесты были на разных частях одного набора из 1000 стихотворений, поэтому результаты pretrained модели чуть-чуть отличаются.


### Пример выводa исходной модели
>**Прошла гроза, умылось небо,  
От туч остались облака,**  
Чтоб быть все равно не позабыть,  
Как я тебя люблю. (с)  
28036259	cooke	2016-06-09 13:00:00	"Красное и черное"     
Одна из самых дорогих кинокартин, которые я когда-либо видел. Фильм снят по мотивам одноименного рассказа Мариво.  
&nbsp;  
&nbsp;  
 <много пустых строк>

### Пример выводa дообученной модели

>**Прошла гроза, умылось небо,  
От туч остались облака,**  
Прошлась по морю вода,  
На земле,  
Озеро разобилось и лепить,  
Темно, звёзды теперь бликует,  
Эту ночь,  
Остаётся пустеет там,  
Все равно свет стоит,  
И луна, и звёзды,  
Врагу не найти,  
Видно, что по ней амчуга  
Находится наводнение,  
И дырявый барометр  
Пасмурно небо  
